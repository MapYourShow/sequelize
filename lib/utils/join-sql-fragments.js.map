{
  "version": 3,
  "sources": ["../../src/utils/join-sql-fragments.ts"],
  "sourcesContent": ["import type { SQLFragment, TruthySQLFragment } from '../generic/sql-fragment';\r\n\r\nfunction doesNotWantLeadingSpace(str: string): boolean {\r\n  return /^[),;]/.test(str);\r\n}\r\n\r\nfunction doesNotWantTrailingSpace(str: string): boolean {\r\n  return str.endsWith('(');\r\n}\r\n\r\n/**\r\n * Joins an array of strings with a single space between them,\r\n * except for:\r\n *\r\n * - Strings starting with ';', ',' and ')', which do not get a leading space.\r\n * - Strings ending with '(', which do not get a trailing space.\r\n *\r\n * @param parts\r\n * @private\r\n */\r\nfunction singleSpaceJoinHelper(parts: string[]): string {\r\n  // eslint-disable-next-line unicorn/no-array-reduce -- TODO\r\n  return parts.reduce(\r\n    ({ skipNextLeadingSpace, result }, part) => {\r\n      if (skipNextLeadingSpace || doesNotWantLeadingSpace(part)) {\r\n        result += part.trim();\r\n      } else {\r\n        result += ` ${part.trim()}`;\r\n      }\r\n\r\n      return {\r\n        skipNextLeadingSpace: doesNotWantTrailingSpace(part),\r\n        result,\r\n      };\r\n    },\r\n    {\r\n      skipNextLeadingSpace: true,\r\n      result: '',\r\n    },\r\n  ).result;\r\n}\r\n\r\n/**\r\n * Joins an array with a single space, auto trimming when needed.\r\n *\r\n * Certain elements do not get leading/trailing spaces.\r\n *\r\n * @param array The array to be joined. Falsy values are skipped. If an\r\n * element is another array, this function will be called recursively on that array.\r\n * Otherwise, if a non-string, non-falsy value is present, a TypeError will be thrown.\r\n *\r\n * @returns The joined string.\r\n *\r\n * @private\r\n */\r\nexport function joinSQLFragments(array: SQLFragment[]): string {\r\n  if (array.length === 0) {\r\n    return '';\r\n  }\r\n\r\n  const truthyArray: TruthySQLFragment[] = array.filter(\r\n    (x): x is string | SQLFragment[] => Boolean(x),\r\n  );\r\n  const flattenedArray: string[] = truthyArray.map(\r\n    (fragment: TruthySQLFragment) => {\r\n      if (Array.isArray(fragment)) {\r\n        return joinSQLFragments(fragment);\r\n      }\r\n\r\n      return fragment;\r\n    },\r\n  );\r\n\r\n  // Ensure strings\r\n  for (const fragment of flattenedArray) {\r\n    if (fragment && typeof fragment !== 'string') {\r\n      throw new JoinSQLFragmentsError(\r\n        flattenedArray,\r\n        fragment,\r\n        `Tried to construct a SQL string with a non-string, non-falsy fragment (${fragment}).`,\r\n      );\r\n    }\r\n  }\r\n\r\n  // Trim fragments\r\n  const trimmedArray = flattenedArray.map(x => x.trim());\r\n\r\n  // Skip full-whitespace fragments (empty after the above trim)\r\n  const nonEmptyStringArray = trimmedArray.filter(x => x !== '');\r\n\r\n  return singleSpaceJoinHelper(nonEmptyStringArray);\r\n}\r\n\r\nexport class JoinSQLFragmentsError extends TypeError {\r\n  args: SQLFragment[];\r\n  fragment: any; // iirc this error is only used when we get an invalid fragment.\r\n\r\n  constructor(args: SQLFragment[], fragment: any, message: string) {\r\n    super(message);\r\n\r\n    this.args = args;\r\n    this.fragment = fragment;\r\n    this.name = 'JoinSQLFragmentsError';\r\n  }\r\n}\r\n"],
  "mappings": ";;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA,iCAAiC,KAAsB;AACrD,SAAO,SAAS,KAAK,GAAG;AAC1B;AAEA,kCAAkC,KAAsB;AACtD,SAAO,IAAI,SAAS,GAAG;AACzB;AAYA,+BAA+B,OAAyB;AAEtD,SAAO,MAAM,OACX,CAAC,EAAE,sBAAsB,UAAU,SAAS;AAC1C,QAAI,wBAAwB,wBAAwB,IAAI,GAAG;AACzD,gBAAU,KAAK,KAAK;AAAA,IACtB,OAAO;AACL,gBAAU,IAAI,KAAK,KAAK;AAAA,IAC1B;AAEA,WAAO;AAAA,MACL,sBAAsB,yBAAyB,IAAI;AAAA,MACnD;AAAA,IACF;AAAA,EACF,GACA;AAAA,IACE,sBAAsB;AAAA,IACtB,QAAQ;AAAA,EACV,CACF,EAAE;AACJ;AAeO,0BAA0B,OAA8B;AAC7D,MAAI,MAAM,WAAW,GAAG;AACtB,WAAO;AAAA,EACT;AAEA,QAAM,cAAmC,MAAM,OAC7C,CAAC,MAAmC,QAAQ,CAAC,CAC/C;AACA,QAAM,iBAA2B,YAAY,IAC3C,CAAC,aAAgC;AAC/B,QAAI,MAAM,QAAQ,QAAQ,GAAG;AAC3B,aAAO,iBAAiB,QAAQ;AAAA,IAClC;AAEA,WAAO;AAAA,EACT,CACF;AAGA,aAAW,YAAY,gBAAgB;AACrC,QAAI,YAAY,OAAO,aAAa,UAAU;AAC5C,YAAM,IAAI,sBACR,gBACA,UACA,0EAA0E,YAC5E;AAAA,IACF;AAAA,EACF;AAGA,QAAM,eAAe,eAAe,IAAI,OAAK,EAAE,KAAK,CAAC;AAGrD,QAAM,sBAAsB,aAAa,OAAO,OAAK,MAAM,EAAE;AAE7D,SAAO,sBAAsB,mBAAmB;AAClD;AAEO,MAAM,8BAA8B,UAAU;AAAA,EACnD;AAAA,EACA;AAAA,EAEA,YAAY,MAAqB,UAAe,SAAiB;AAC/D,UAAM,OAAO;AAEb,SAAK,OAAO;AACZ,SAAK,WAAW;AAChB,SAAK,OAAO;AAAA,EACd;AACF;",
  "names": []
}
