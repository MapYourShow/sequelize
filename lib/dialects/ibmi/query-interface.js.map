{
  "version": 3,
  "sources": ["../../../src/dialects/ibmi/query-interface.js"],
  "sourcesContent": ["'use strict';\r\n\r\nconst { Transaction } = require('../../transaction');\r\nconst { QueryInterface } = require('../abstract/query-interface');\r\n\r\n/**\r\n Returns an object that enables the `ibmi` dialect to call underlying odbc\r\n transaction functions through the connection methods instead\r\n\r\n @class QueryInterface\r\n @static\r\n @private\r\n */\r\n\r\nexport class IBMiQueryInterface extends QueryInterface {\r\n\r\n  startTransaction(transaction, options) {\r\n    if (!(transaction instanceof Transaction)) {\r\n      throw new TypeError('Unable to start a transaction without transaction object!');\r\n    }\r\n\r\n    options = { ...options, transaction: transaction.parent || transaction };\r\n\r\n    options.transaction.name = transaction.parent ? transaction.name : undefined;\r\n\r\n    return transaction.connection.beginTransaction();\r\n  }\r\n\r\n  commitTransaction(transaction) {\r\n    if (!(transaction instanceof Transaction)) {\r\n      throw new TypeError('Unable to commit a transaction without transaction object!');\r\n    }\r\n\r\n    if (transaction.parent) {\r\n      throw new Error('Unable to commit a transaction that has a parent transaction!');\r\n    }\r\n\r\n    const promise = transaction.connection.commit();\r\n    transaction.finished = 'commit';\r\n\r\n    return promise;\r\n  }\r\n\r\n  rollbackTransaction(transaction, options) {\r\n    if (!(transaction instanceof Transaction)) {\r\n      throw new TypeError('Unable to rollback a transaction without transaction object!');\r\n    }\r\n\r\n    options = {\r\n      ...options,\r\n      transaction: transaction.parent || transaction,\r\n      supportsSearchPath: false,\r\n      completesTransaction: true,\r\n    };\r\n    options.transaction.name = transaction.parent ? transaction.name : undefined;\r\n\r\n    const promise = transaction.connection.rollback();\r\n    transaction.finished = 'commit';\r\n\r\n    return promise;\r\n  }\r\n}\r\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA,MAAM,EAAE,gBAAgB,QAAQ,mBAAmB;AACnD,MAAM,EAAE,mBAAmB,QAAQ,6BAA6B;AAWzD,MAAM,2BAA2B,eAAe;AAAA,EAErD,iBAAiB,aAAa,SAAS;AACrC,QAAI,CAAE,wBAAuB,cAAc;AACzC,YAAM,IAAI,UAAU,2DAA2D;AAAA,IACjF;AAEA,cAAU,iCAAK,UAAL,EAAc,aAAa,YAAY,UAAU,YAAY;AAEvE,YAAQ,YAAY,OAAO,YAAY,SAAS,YAAY,OAAO;AAEnE,WAAO,YAAY,WAAW,iBAAiB;AAAA,EACjD;AAAA,EAEA,kBAAkB,aAAa;AAC7B,QAAI,CAAE,wBAAuB,cAAc;AACzC,YAAM,IAAI,UAAU,4DAA4D;AAAA,IAClF;AAEA,QAAI,YAAY,QAAQ;AACtB,YAAM,IAAI,MAAM,+DAA+D;AAAA,IACjF;AAEA,UAAM,UAAU,YAAY,WAAW,OAAO;AAC9C,gBAAY,WAAW;AAEvB,WAAO;AAAA,EACT;AAAA,EAEA,oBAAoB,aAAa,SAAS;AACxC,QAAI,CAAE,wBAAuB,cAAc;AACzC,YAAM,IAAI,UAAU,8DAA8D;AAAA,IACpF;AAEA,cAAU,iCACL,UADK;AAAA,MAER,aAAa,YAAY,UAAU;AAAA,MACnC,oBAAoB;AAAA,MACpB,sBAAsB;AAAA,IACxB;AACA,YAAQ,YAAY,OAAO,YAAY,SAAS,YAAY,OAAO;AAEnE,UAAM,UAAU,YAAY,WAAW,SAAS;AAChD,gBAAY,WAAW;AAEvB,WAAO;AAAA,EACT;AACF;",
  "names": []
}
