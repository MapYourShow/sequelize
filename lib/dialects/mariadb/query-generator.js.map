{
  "version": 3,
  "sources": ["../../../src/dialects/mariadb/query-generator.js"],
  "sourcesContent": ["'use strict';\r\n\r\nconst { MySqlQueryGenerator } = require('../mysql/query-generator');\r\nconst Utils = require('./../../utils');\r\nconst _ = require('lodash');\r\n\r\nexport class MariaDbQueryGenerator extends MySqlQueryGenerator {\r\n  createSchema(schema, options) {\r\n    options = {\r\n      charset: null,\r\n      collate: null,\r\n      ...options,\r\n    };\r\n\r\n    return Utils.joinSQLFragments([\r\n      'CREATE SCHEMA IF NOT EXISTS',\r\n      this.quoteIdentifier(schema),\r\n      options.charset && `DEFAULT CHARACTER SET ${this.escape(options.charset)}`,\r\n      options.collate && `DEFAULT COLLATE ${this.escape(options.collate)}`,\r\n      ';',\r\n    ]);\r\n  }\r\n\r\n  dropSchema(schema) {\r\n    return `DROP SCHEMA IF EXISTS ${this.quoteIdentifier(schema)};`;\r\n  }\r\n\r\n  showSchemasQuery(options) {\r\n    const schemasToSkip = [\r\n      '\\'MYSQL\\'',\r\n      '\\'INFORMATION_SCHEMA\\'',\r\n      '\\'PERFORMANCE_SCHEMA\\'',\r\n    ];\r\n    if (options.skip && Array.isArray(options.skip) && options.skip.length > 0) {\r\n      for (const schemaName of options.skip) {\r\n        schemasToSkip.push(this.escape(schemaName));\r\n      }\r\n    }\r\n\r\n    return Utils.joinSQLFragments([\r\n      'SELECT SCHEMA_NAME as schema_name',\r\n      'FROM INFORMATION_SCHEMA.SCHEMATA',\r\n      `WHERE SCHEMA_NAME NOT IN (${schemasToSkip.join(', ')})`,\r\n      ';',\r\n    ]);\r\n  }\r\n\r\n  showTablesQuery(database) {\r\n    let query = 'SELECT TABLE_NAME, TABLE_SCHEMA FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_TYPE = \\'BASE TABLE\\'';\r\n    if (database) {\r\n      query += ` AND TABLE_SCHEMA = ${this.escape(database)}`;\r\n    } else {\r\n      query += ' AND TABLE_SCHEMA NOT IN (\\'MYSQL\\', \\'INFORMATION_SCHEMA\\', \\'PERFORMANCE_SCHEMA\\')';\r\n    }\r\n\r\n    return `${query};`;\r\n  }\r\n\r\n  /**\r\n   * Quote identifier in sql clause\r\n   *\r\n   * @param {string} identifier\r\n   * @param {boolean} force\r\n   *\r\n   * @returns {string}\r\n   */\r\n  quoteIdentifier(identifier, force) {\r\n    return Utils.addTicks(Utils.removeTicks(identifier, '`'), '`');\r\n  }\r\n\r\n  /**\r\n   * Generates an SQL query that extract JSON property of given path.\r\n   *\r\n   * @param   {string}               column  The JSON column\r\n   * @param   {string|Array<string>} [path]  The path to extract (optional)\r\n   * @param   {boolean}              [isJson] The value is JSON use alt symbols (optional)\r\n   * @returns {string}                       The generated sql query\r\n   * @private\r\n   */\r\n  jsonPathExtractionQuery(column, path, isJson) {\r\n\r\n    const quotedColumn = this.isIdentifierQuoted(column)\r\n      ? column\r\n      : this.quoteIdentifier(column);\r\n\r\n    const pathStr = this.escape(['$']\r\n      .concat(_.toPath(path))\r\n      .join('.')\r\n      .replace(/\\.(\\d+)(?:(?=\\.)|$)/g, (__, digit) => `[${digit}]`));\r\n\r\n    return `json_unquote(json_extract(${quotedColumn},${pathStr}))`;\r\n  }\r\n}\r\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA,MAAM,EAAE,wBAAwB,QAAQ,0BAA0B;AAClE,MAAM,QAAQ,QAAQ,eAAe;AACrC,MAAM,IAAI,QAAQ,QAAQ;AAEnB,MAAM,8BAA8B,oBAAoB;AAAA,EAC7D,aAAa,QAAQ,SAAS;AAC5B,cAAU;AAAA,MACR,SAAS;AAAA,MACT,SAAS;AAAA,OACN;AAGL,WAAO,MAAM,iBAAiB;AAAA,MAC5B;AAAA,MACA,KAAK,gBAAgB,MAAM;AAAA,MAC3B,QAAQ,WAAW,yBAAyB,KAAK,OAAO,QAAQ,OAAO;AAAA,MACvE,QAAQ,WAAW,mBAAmB,KAAK,OAAO,QAAQ,OAAO;AAAA,MACjE;AAAA,IACF,CAAC;AAAA,EACH;AAAA,EAEA,WAAW,QAAQ;AACjB,WAAO,yBAAyB,KAAK,gBAAgB,MAAM;AAAA,EAC7D;AAAA,EAEA,iBAAiB,SAAS;AACxB,UAAM,gBAAgB;AAAA,MACpB;AAAA,MACA;AAAA,MACA;AAAA,IACF;AACA,QAAI,QAAQ,QAAQ,MAAM,QAAQ,QAAQ,IAAI,KAAK,QAAQ,KAAK,SAAS,GAAG;AAC1E,iBAAW,cAAc,QAAQ,MAAM;AACrC,sBAAc,KAAK,KAAK,OAAO,UAAU,CAAC;AAAA,MAC5C;AAAA,IACF;AAEA,WAAO,MAAM,iBAAiB;AAAA,MAC5B;AAAA,MACA;AAAA,MACA,6BAA6B,cAAc,KAAK,IAAI;AAAA,MACpD;AAAA,IACF,CAAC;AAAA,EACH;AAAA,EAEA,gBAAgB,UAAU;AACxB,QAAI,QAAQ;AACZ,QAAI,UAAU;AACZ,eAAS,uBAAuB,KAAK,OAAO,QAAQ;AAAA,IACtD,OAAO;AACL,eAAS;AAAA,IACX;AAEA,WAAO,GAAG;AAAA,EACZ;AAAA,EAUA,gBAAgB,YAAY,OAAO;AACjC,WAAO,MAAM,SAAS,MAAM,YAAY,YAAY,GAAG,GAAG,GAAG;AAAA,EAC/D;AAAA,EAWA,wBAAwB,QAAQ,MAAM,QAAQ;AAE5C,UAAM,eAAe,KAAK,mBAAmB,MAAM,IAC/C,SACA,KAAK,gBAAgB,MAAM;AAE/B,UAAM,UAAU,KAAK,OAAO,CAAC,GAAG,EAC7B,OAAO,EAAE,OAAO,IAAI,CAAC,EACrB,KAAK,GAAG,EACR,QAAQ,wBAAwB,CAAC,IAAI,UAAU,IAAI,QAAQ,CAAC;AAE/D,WAAO,6BAA6B,gBAAgB;AAAA,EACtD;AACF;",
  "names": []
}
