{
  "version": 3,
  "sources": ["../../../src/dialects/mysql/data-types.js"],
  "sourcesContent": ["'use strict';\r\n\r\nconst wkx = require('wkx');\r\nconst _ = require('lodash');\r\nconst dayjs = require('dayjs');\r\nconst { isValidTimeZone } = require('../../utils/dayjs');\r\n\r\nmodule.exports = BaseTypes => {\r\n  BaseTypes.ABSTRACT.prototype.dialectTypes = 'https://dev.mysql.com/doc/refman/5.7/en/data-types.html';\r\n\r\n  /**\r\n   * types: [buffer_type, ...]\r\n   *\r\n   * @see buffer_type here https://dev.mysql.com/doc/refman/5.7/en/c-api-prepared-statement-type-codes.html\r\n   * @see hex here https://github.com/sidorares/node-mysql2/blob/master/lib/constants/types.js\r\n   */\r\n\r\n  BaseTypes.DATE.types.mysql = ['DATETIME'];\r\n  BaseTypes.STRING.types.mysql = ['VAR_STRING'];\r\n  BaseTypes.CHAR.types.mysql = ['STRING'];\r\n  BaseTypes.TEXT.types.mysql = ['BLOB'];\r\n  BaseTypes.TINYINT.types.mysql = ['TINY'];\r\n  BaseTypes.SMALLINT.types.mysql = ['SHORT'];\r\n  BaseTypes.MEDIUMINT.types.mysql = ['INT24'];\r\n  BaseTypes.INTEGER.types.mysql = ['LONG'];\r\n  BaseTypes.BIGINT.types.mysql = ['LONGLONG'];\r\n  BaseTypes.FLOAT.types.mysql = ['FLOAT'];\r\n  BaseTypes.TIME.types.mysql = ['TIME'];\r\n  BaseTypes.DATEONLY.types.mysql = ['DATE'];\r\n  BaseTypes.BOOLEAN.types.mysql = ['TINY'];\r\n  BaseTypes.BLOB.types.mysql = ['TINYBLOB', 'BLOB', 'LONGBLOB'];\r\n  BaseTypes.DECIMAL.types.mysql = ['NEWDECIMAL'];\r\n  BaseTypes.UUID.types.mysql = false;\r\n  BaseTypes.ENUM.types.mysql = false;\r\n  BaseTypes.REAL.types.mysql = ['DOUBLE'];\r\n  BaseTypes.DOUBLE.types.mysql = ['DOUBLE'];\r\n  BaseTypes.GEOMETRY.types.mysql = ['GEOMETRY'];\r\n  BaseTypes.JSON.types.mysql = ['JSON'];\r\n\r\n  class DECIMAL extends BaseTypes.DECIMAL {\r\n    toSql() {\r\n      let definition = super.toSql();\r\n      if (this._unsigned) {\r\n        definition += ' UNSIGNED';\r\n      }\r\n\r\n      if (this._zerofill) {\r\n        definition += ' ZEROFILL';\r\n      }\r\n\r\n      return definition;\r\n    }\r\n  }\r\n\r\n  class DATE extends BaseTypes.DATE {\r\n    toSql() {\r\n      return this._length ? `DATETIME(${this._length})` : 'DATETIME';\r\n    }\r\n\r\n    _stringify(date, options) {\r\n      date = this._applyTimezone(date, options);\r\n\r\n      // Fractional DATETIMEs only supported on MySQL 5.6.4+\r\n      if (this._length) {\r\n        return date.format('YYYY-MM-DD HH:mm:ss.SSS');\r\n      }\r\n\r\n      return date.format('YYYY-MM-DD HH:mm:ss');\r\n    }\r\n\r\n    static parse(value, options) {\r\n      value = value.string();\r\n      if (value === null) {\r\n        return value;\r\n      }\r\n\r\n      if (isValidTimeZone(options.timezone)) {\r\n        value = dayjs.tz(value, options.timezone).toDate();\r\n      } else {\r\n        value = new Date(`${value} ${options.timezone}`);\r\n      }\r\n\r\n      return value;\r\n    }\r\n  }\r\n\r\n  class DATEONLY extends BaseTypes.DATEONLY {\r\n    static parse(value) {\r\n      return value.string();\r\n    }\r\n  }\r\n\r\n  class UUID extends BaseTypes.UUID {\r\n    toSql() {\r\n      return 'CHAR(36) BINARY';\r\n    }\r\n  }\r\n\r\n  const SUPPORTED_GEOMETRY_TYPES = ['POINT', 'LINESTRING', 'POLYGON'];\r\n\r\n  class GEOMETRY extends BaseTypes.GEOMETRY {\r\n    constructor(type, srid) {\r\n      super(type, srid);\r\n      if (_.isEmpty(this.type)) {\r\n        this.sqlType = this.key;\r\n\r\n        return;\r\n      }\r\n\r\n      if (SUPPORTED_GEOMETRY_TYPES.includes(this.type)) {\r\n        this.sqlType = this.type;\r\n\r\n        return;\r\n      }\r\n\r\n      throw new Error(`Supported geometry types are: ${SUPPORTED_GEOMETRY_TYPES.join(', ')}`);\r\n    }\r\n\r\n    static parse(value) {\r\n      value = value.buffer();\r\n      // Empty buffer, MySQL doesn't support POINT EMPTY\r\n      // check, https://dev.mysql.com/worklog/task/?id=2381\r\n      if (!value || value.length === 0) {\r\n        return null;\r\n      }\r\n\r\n      // For some reason, discard the first 4 bytes\r\n      value = value.slice(4);\r\n\r\n      return wkx.Geometry.parse(value).toGeoJSON({ shortCrs: true });\r\n    }\r\n\r\n    toSql() {\r\n      return this.sqlType;\r\n    }\r\n  }\r\n\r\n  class ENUM extends BaseTypes.ENUM {\r\n    toSql(options) {\r\n      return `ENUM(${this.values.map(value => options.escape(value)).join(', ')})`;\r\n    }\r\n  }\r\n\r\n  class JSONTYPE extends BaseTypes.JSON {\r\n    _stringify(value, options) {\r\n      return options.operation === 'where' && typeof value === 'string' ? value : JSON.stringify(value);\r\n    }\r\n  }\r\n\r\n  return {\r\n    ENUM,\r\n    DATE,\r\n    DATEONLY,\r\n    UUID,\r\n    GEOMETRY,\r\n    DECIMAL,\r\n    JSON: JSONTYPE,\r\n  };\r\n};\r\n"],
  "mappings": "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",
  "names": []
}
