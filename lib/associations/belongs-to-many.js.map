{
  "version": 3,
  "sources": ["../../src/associations/belongs-to-many.ts"],
  "sourcesContent": ["import each from 'lodash/each';\r\nimport isEqual from 'lodash/isEqual';\r\nimport isPlainObject from 'lodash/isPlainObject';\r\nimport omit from 'lodash/omit';\r\nimport upperFirst from 'lodash/upperFirst';\r\nimport { AssociationError } from '../errors';\r\nimport type {\r\n  BulkCreateOptions,\r\n  CreateOptions,\r\n  CreationAttributes,\r\n  Filterable,\r\n  FindAttributeOptions,\r\n  FindOptions,\r\n  InstanceDestroyOptions,\r\n  InstanceUpdateOptions,\r\n  Transactionable,\r\n  ModelStatic,\r\n  Model,\r\n  WhereOptions,\r\n  AttributeNames,\r\n  Attributes,\r\n  Includeable,\r\n  ModelAttributes,\r\n  UpdateOptions,\r\n  ModelOptions,\r\n} from '../model';\r\nimport { Op } from '../operators';\r\nimport type { Sequelize } from '../sequelize';\r\nimport { col, fn } from '../sequelize';\r\nimport type { AllowArray } from '../utils';\r\nimport { camelize } from '../utils';\r\nimport { isModelStatic, isSameInitialModel } from '../utils/model-utils.js';\r\nimport type {\r\n  AssociationScope,\r\n  ForeignKeyOptions,\r\n  MultiAssociationOptions,\r\n  MultiAssociationAccessors,\r\n  AssociationOptions,\r\n  NormalizedAssociationOptions,\r\n  Association,\r\n} from './base';\r\nimport { MultiAssociation } from './base';\r\nimport type { BelongsTo } from './belongs-to';\r\nimport { HasMany } from './has-many';\r\nimport { HasOne } from './has-one';\r\nimport type { AssociationStatic } from './helpers';\r\nimport {\r\n  AssociationConstructorSecret,\r\n  defineAssociation,\r\n  mixinMethods, normalizeBaseAssociationOptions, normalizeForeignKeyOptions, removeUndefined,\r\n} from './helpers';\r\n\r\nfunction addInclude(findOptions: FindOptions, include: Includeable) {\r\n  if (Array.isArray(findOptions.include)) {\r\n    findOptions.include.push(include);\r\n  } else if (!findOptions.include) {\r\n    findOptions.include = [include];\r\n  } else {\r\n    findOptions.include = [findOptions.include, include];\r\n  }\r\n}\r\n\r\n/**\r\n * Many-to-many association with a join/through table.\r\n * See {@link Model.belongsToMany}\r\n *\r\n * When the join table has additional attributes, these can be passed in the options object:\r\n *\r\n * ```js\r\n * UserProject = sequelize.define('user_project', {\r\n *   role: DataTypes.STRING\r\n * });\r\n * User.belongsToMany(Project, { through: UserProject });\r\n * Project.belongsToMany(User, { through: UserProject });\r\n * // through is required!\r\n *\r\n * user.addProject(project, { through: { role: 'manager' }});\r\n * ```\r\n *\r\n * All methods allow you to pass either a persisted instance, its primary key, or a mixture:\r\n *\r\n * ```js\r\n * const project = await Project.create({ id: 11 });\r\n * await user.addProjects([project, 12]);\r\n * ```\r\n *\r\n * If you want to set several target instances, but with different attributes you have to set the attributes on the instance, using a property with the name of the through model:\r\n *\r\n * ```js\r\n * p1.UserProjects = {\r\n *   started: true\r\n * }\r\n * user.setProjects([p1, p2], { through: { started: false }}) // The default value is false, but p1 overrides that.\r\n * ```\r\n *\r\n * Similarly, when fetching through a join table with custom attributes, these attributes will be available as an object with the name of the through model.\r\n * ```js\r\n * const projects = await user.getProjects();\r\n * const p1 = projects[0];\r\n * p1.UserProjects.started // Is this project started yet?\r\n * ```\r\n *\r\n * In the API reference below, add the name of the association to the method, e.g. for `User.belongsToMany(Project)` the getter will be `user.getProjects()`.\r\n */\r\nexport class BelongsToMany<\r\n  SourceModel extends Model = Model,\r\n  TargetModel extends Model = Model,\r\n  ThroughModel extends Model = Model,\r\n  SourceKey extends AttributeNames<SourceModel> = any,\r\n  TargetKey extends AttributeNames<TargetModel> = any,\r\n> extends MultiAssociation<\r\n  SourceModel,\r\n  TargetModel,\r\n  /* ForeignKey */ string,\r\n  TargetKey,\r\n  NormalizedBelongsToManyOptions<SourceKey, TargetKey, ThroughModel>\r\n> {\r\n  readonly accessors: MultiAssociationAccessors;\r\n\r\n  get foreignKey(): string {\r\n    return this.fromSourceToThrough.foreignKey;\r\n  }\r\n\r\n  /**\r\n   * The name of the Foreign Key attribute, located on the through table, that points to the Target model.\r\n   *\r\n   * Not to be confused with @link {BelongsToMany.foreignKey}, which points to the Source model instead.\r\n   */\r\n  get otherKey(): string {\r\n    return this.pairedWith.foreignKey;\r\n  }\r\n\r\n  /**\r\n   * @deprecated use {@link BelongsToMany#foreignKey}\r\n   */\r\n  get identifier() {\r\n    return this.foreignKey;\r\n  }\r\n\r\n  /**\r\n   * The corresponding column name of {@link BelongsToMany#foreignKey}\r\n   */\r\n  get identifierField(): string {\r\n    return this.fromThroughToSource.identifierField;\r\n  }\r\n\r\n  /**\r\n   * The corresponding column name of {@link BelongsToMany#otherKey}\r\n   */\r\n  get foreignIdentifierField() {\r\n    return this.pairedWith.identifierField;\r\n  }\r\n\r\n  /**\r\n   * The name of the Attribute that the {@link foreignKey} fk (located on the Through Model) will reference on the Source model.\r\n   */\r\n  get sourceKey(): SourceKey {\r\n    return this.fromThroughToSource.targetKey;\r\n  }\r\n\r\n  /**\r\n   * The name of the Column that the {@link foreignKey} fk (located on the Through Table) will reference on the Source model.\r\n   */\r\n  get sourceKeyField(): string {\r\n    return this.fromThroughToSource.targetKeyField;\r\n  }\r\n\r\n  /**\r\n   * The name of the Attribute that the {@link otherKey} fk (located on the Through Model) will reference on the Target model.\r\n   */\r\n  get targetKey(): TargetKey {\r\n    return this.pairedWith.sourceKey;\r\n  }\r\n\r\n  /**\r\n   * The name of the Column that the {@link otherKey} fk (located on the Through Table) will reference on the Target model.\r\n   */\r\n  get targetKeyField(): string {\r\n    return this.pairedWith.sourceKeyField;\r\n  }\r\n\r\n  /**\r\n   * The corresponding association this entity is paired with.\r\n   */\r\n  pairedWith: BelongsToMany<TargetModel, SourceModel, ThroughModel, TargetKey, SourceKey>;\r\n\r\n  // intermediary associations\r\n  // these create the actual associations on the model. Remove them would be a breaking change.\r\n  readonly fromSourceToThrough: HasMany<SourceModel, ThroughModel, SourceKey, any>;\r\n  readonly fromSourceToThroughOne: HasOne<SourceModel, ThroughModel, SourceKey, any>;\r\n  get fromThroughToSource(): BelongsTo<ThroughModel, SourceModel, any, SourceKey> {\r\n    return this.fromSourceToThrough.inverse;\r\n  }\r\n\r\n  get fromTargetToThrough(): HasMany<TargetModel, ThroughModel, TargetKey, any> {\r\n    return this.pairedWith.fromSourceToThrough;\r\n  }\r\n\r\n  get fromTargetToThroughOne(): HasOne<TargetModel, ThroughModel, TargetKey, any> {\r\n    return this.pairedWith.fromSourceToThroughOne;\r\n  }\r\n\r\n  get fromThroughToTarget(): BelongsTo<ThroughModel, TargetModel, any, TargetKey> {\r\n    return this.pairedWith.fromThroughToSource;\r\n  }\r\n\r\n  get through(): NormalizedThroughOptions<ThroughModel> {\r\n    return this.options.through;\r\n  }\r\n\r\n  get throughModel(): ModelStatic<ThroughModel> {\r\n    return this.through.model;\r\n  }\r\n\r\n  constructor(\r\n    secret: symbol,\r\n    source: ModelStatic<SourceModel>,\r\n    target: ModelStatic<TargetModel>,\r\n    options: NormalizedBelongsToManyOptions<SourceKey, TargetKey, ThroughModel>,\r\n    pair?: BelongsToMany<TargetModel, SourceModel, ThroughModel, TargetKey, SourceKey>,\r\n    parent?: Association<any>,\r\n  ) {\r\n    super(secret, source, target, options, parent);\r\n\r\n    try {\r\n      this.pairedWith = pair ?? BelongsToMany.associate<TargetModel, SourceModel, ThroughModel, TargetKey, SourceKey>(\r\n        secret,\r\n        target,\r\n        source,\r\n        {\r\n          ...options,\r\n          // note: we can't just use '...options.inverse' because we need to set to underfined if the option wasn't set\r\n          as: options.inverse?.as,\r\n          scope: options.inverse?.scope,\r\n          foreignKeyConstraints: options.inverse?.foreignKeyConstraints,\r\n\r\n          inverse: {\r\n            as: options.as,\r\n            scope: options.scope,\r\n            foreignKeyConstraints: options.foreignKeyConstraints,\r\n          },\r\n          sourceKey: options.targetKey,\r\n          targetKey: options.sourceKey,\r\n          foreignKey: options.otherKey,\r\n          otherKey: options.foreignKey,\r\n          through: {\r\n            ...options.through,\r\n            scope: undefined,\r\n          },\r\n        },\r\n        this,\r\n        this,\r\n      );\r\n    } catch (error) {\r\n      throw new AssociationError(`BelongsToMany associations automatically create the corresponding association on the target model,\r\n    but this association failed to create its paired association (BelongsToMany from ${target.name} to ${source.name}).\r\n\r\n    This may happen if you try to define the same BelongsToMany association on both sides of the association.\r\n    If that is the case, instead of doing this:\r\n    A.belongsToMany(B, { as: 'b', through: 'AB' });\r\n    B.belongsToMany(A, { as: 'a', through: 'AB' });\r\n\r\n    Do this:\r\n    A.belongsToMany(B, { as: 'b', through: 'AB', inverse: { as: 'a' } });\r\n          `, { cause: error as Error });\r\n    }\r\n\r\n    // we'll need to access their foreign key (through .otherKey) in this constructor.\r\n    // this makes sure it's created\r\n    this.pairedWith.pairedWith = this;\r\n\r\n    const sourceKey = options?.sourceKey || (source.primaryKeyAttribute as TargetKey);\r\n\r\n    this.fromSourceToThrough = HasMany.associate(AssociationConstructorSecret, this.source, this.throughModel, {\r\n      as: `${this.name.plural}${upperFirst(this.pairedWith.name.plural)}`,\r\n      scope: this.through.scope,\r\n      foreignKey: {\r\n        ...this.options.foreignKey,\r\n        allowNull: this.options.foreignKey.allowNull ?? false,\r\n        name: this.options.foreignKey.name || (\r\n          this.isSelfAssociation ? camelize(`${this.pairedWith.name.singular}_${sourceKey}`)\r\n            : camelize(`${this.source.options.name.singular}_${sourceKey}`)\r\n        ),\r\n      },\r\n      sourceKey: this.options.sourceKey,\r\n      foreignKeyConstraints: this.options.foreignKeyConstraints,\r\n      hooks: this.options.hooks,\r\n      inverse: {\r\n        as: this.pairedWith.name.singular,\r\n      },\r\n    }, this);\r\n\r\n    this.fromSourceToThroughOne = HasOne.associate(AssociationConstructorSecret, this.source, this.throughModel, {\r\n      as: `${this.name.singular}${upperFirst(this.pairedWith.name.singular)}`,\r\n      scope: this.through.scope,\r\n      // foreignKey: this.options.foreignKey,\r\n      foreignKey: {\r\n        ...this.options.foreignKey,\r\n        allowNull: this.options.foreignKey.allowNull ?? false,\r\n        name: this.options.foreignKey.name || (\r\n          this.isSelfAssociation ? camelize(`${this.pairedWith.name.singular}_${sourceKey}`)\r\n            : camelize(`${this.source.options.name.singular}_${sourceKey}`)\r\n        ),\r\n      },\r\n      sourceKey: this.options.sourceKey,\r\n      foreignKeyConstraints: this.options.foreignKeyConstraints,\r\n      hooks: this.options.hooks,\r\n      inverse: {\r\n        as: this.pairedWith.name.singular,\r\n      },\r\n    }, this);\r\n\r\n    // Get singular and plural names, trying to uppercase the first letter, unless the model forbids it\r\n    const plural = upperFirst(this.options.name.plural);\r\n    const singular = upperFirst(this.options.name.singular);\r\n\r\n    this.accessors = {\r\n      get: `get${plural}`,\r\n      set: `set${plural}`,\r\n      addMultiple: `add${plural}`,\r\n      add: `add${singular}`,\r\n      create: `create${singular}`,\r\n      remove: `remove${singular}`,\r\n      removeMultiple: `remove${plural}`,\r\n      hasSingle: `has${singular}`,\r\n      hasAll: `has${plural}`,\r\n      count: `count${plural}`,\r\n    };\r\n\r\n    this.#mixin(source.prototype);\r\n\r\n    // we are the 'parent' of the belongs-to-many pair\r\n    if (pair == null) {\r\n      this.#makeFkPairUnique();\r\n    }\r\n  }\r\n\r\n  #makeFkPairUnique() {\r\n    let hasPrimaryKey = false;\r\n\r\n    // remove any PKs previously defined by sequelize\r\n    // but ignore any keys that are part of this association (#5865)\r\n    each(this.through.model.rawAttributes, (attribute, attributeName) => {\r\n      if (!attribute.primaryKey) {\r\n        return;\r\n      }\r\n\r\n      if ([this.foreignKey, this.otherKey].includes(attributeName)) {\r\n        return;\r\n      }\r\n\r\n      if (attribute._autoGenerated) {\r\n        delete this.through.model.rawAttributes[attributeName];\r\n\r\n        return;\r\n      }\r\n\r\n      hasPrimaryKey = true;\r\n    });\r\n\r\n    if (!hasPrimaryKey) {\r\n      if (typeof this.through.unique === 'string') {\r\n        throw new TypeError(`BelongsToMany: Option \"through.unique\" can only be used if the through model's foreign keys are not also the primary keys.\r\nAdd your own primary key to the through model, on different attributes than the foreign keys, to be able to use this option.`);\r\n      }\r\n\r\n      this.throughModel.rawAttributes[this.foreignKey].primaryKey = true;\r\n      this.throughModel.rawAttributes[this.otherKey].primaryKey = true;\r\n    } else if (this.through.unique !== false) {\r\n      let uniqueKey;\r\n      if (typeof this.through.unique === 'string' && this.through.unique !== '') {\r\n        uniqueKey = this.through.unique;\r\n      } else {\r\n        const keys = [this.foreignKey, this.otherKey].sort();\r\n        uniqueKey = [this.through.model.tableName, ...keys, 'unique'].join('_');\r\n      }\r\n\r\n      this.throughModel.rawAttributes[this.foreignKey].unique = uniqueKey;\r\n      this.throughModel.rawAttributes[this.otherKey].unique = uniqueKey;\r\n    }\r\n\r\n    this.throughModel.refreshAttributes();\r\n  }\r\n\r\n  static associate<\r\n    S extends Model,\r\n    T extends Model,\r\n    ThroughModel extends Model,\r\n    SourceKey extends AttributeNames<S>,\r\n    TargetKey extends AttributeNames<T>,\r\n  >(\r\n    secret: symbol,\r\n    source: ModelStatic<S>,\r\n    target: ModelStatic<T>,\r\n    options: BelongsToManyOptions<SourceKey, TargetKey, ThroughModel>,\r\n    pair?: BelongsToMany<T, S, ThroughModel, TargetKey, SourceKey>,\r\n    parent?: Association<any>,\r\n  ): BelongsToMany<S, T, ThroughModel, SourceKey, TargetKey> {\r\n    return defineAssociation<\r\n      BelongsToMany<S, T, ThroughModel, SourceKey, TargetKey>,\r\n      BelongsToManyOptions<SourceKey, TargetKey, ThroughModel>,\r\n      NormalizedBelongsToManyOptions<SourceKey, TargetKey, ThroughModel>\r\n    >(BelongsToMany, source, target, options, parent, normalizeOptions, newOptions => {\r\n      // self-associations must always set their 'as' parameter\r\n      if (isSameInitialModel(source, target)\r\n        // use 'options' because this will always be set in 'newOptions'\r\n        && (!options.as || !options.inverse?.as || options.as === options.inverse.as)) {\r\n        throw new AssociationError('Both options \"as\" and \"inverse.as\" must be defined for belongsToMany self-associations, and their value must be different.');\r\n      }\r\n\r\n      return new BelongsToMany(secret, source, target, newOptions, pair, parent);\r\n    });\r\n  }\r\n\r\n  #mixin(modelPrototype: Model) {\r\n\r\n    mixinMethods(\r\n      this,\r\n      modelPrototype,\r\n      ['get', 'count', 'hasSingle', 'hasAll', 'set', 'add', 'addMultiple', 'remove', 'removeMultiple', 'create'],\r\n      {\r\n        hasSingle: 'has',\r\n        hasAll: 'has',\r\n        addMultiple: 'add',\r\n        removeMultiple: 'remove',\r\n      },\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get everything currently associated with this, using an optional where clause.\r\n   *\r\n   * See {@link Model} for a full explanation of options\r\n   *\r\n   * @param instance instance\r\n   * @param options find options\r\n   */\r\n  async get(instance: SourceModel, options?: BelongsToManyGetAssociationsMixinOptions<TargetModel>): Promise<TargetModel[]> {\r\n    const through = this.through;\r\n\r\n    const findOptions: FindOptions<Attributes<TargetModel>> = {\r\n      ...options,\r\n      // TODO: current WhereOptions typings do not allow having 'WhereOptions' inside another 'WhereOptions'\r\n      // @ts-expect-error\r\n      where: {\r\n        [Op.and]: [\r\n          options?.where,\r\n          this.scope,\r\n        ],\r\n      },\r\n    };\r\n\r\n    let throughWhere = {\r\n      [this.foreignKey]: instance.get(this.sourceKey),\r\n    };\r\n\r\n    if (through.scope) {\r\n      Object.assign(throughWhere, through.scope);\r\n    }\r\n\r\n    // If a user pass a where on the options through options, make an \"and\" with the current throughWhere\r\n    if (options?.through?.where) {\r\n      throughWhere = {\r\n        [Op.and]: [throughWhere, options.through.where],\r\n      };\r\n    }\r\n\r\n    addInclude(findOptions, {\r\n      association: this.fromTargetToThroughOne,\r\n      attributes: options?.joinTableAttributes,\r\n      required: true,\r\n      paranoid: options?.through?.paranoid ?? true,\r\n      where: throughWhere,\r\n    });\r\n\r\n    let model = this.target;\r\n    if (options?.scope != null) {\r\n      if (!options.scope) {\r\n        model = model.unscoped();\r\n      } else if (options.scope !== true) { // 'true' means default scope. Which is the same as not doing anything.\r\n        model = model.scope(options.scope);\r\n      }\r\n    }\r\n\r\n    if (options?.schema) {\r\n      model = model.schema(options.schema, options.schemaDelimiter);\r\n    }\r\n\r\n    return model.findAll(findOptions);\r\n  }\r\n\r\n  /**\r\n   * Count everything currently associated with this, using an optional where clause.\r\n   *\r\n   * @param instance instance\r\n   * @param options find options\r\n   */\r\n  async count(instance: SourceModel, options?: BelongsToManyCountAssociationsMixinOptions<TargetModel>): Promise<number> {\r\n    const getOptions: BelongsToManyGetAssociationsMixinOptions<TargetModel> = {\r\n      ...options,\r\n      attributes: [\r\n        [fn('COUNT', col([this.target.name, this.targetKeyField].join('.'))), 'count'],\r\n      ],\r\n      joinTableAttributes: [],\r\n      raw: true,\r\n      plain: true,\r\n    };\r\n\r\n    const result = await this.get(instance, getOptions);\r\n\r\n    // @ts-expect-error -- this.get() isn't designed to expect returning a raw output.\r\n    return Number.parseInt(result.count, 10);\r\n  }\r\n\r\n  /**\r\n   * Check if one or more instance(s) are associated with this. If a list of instances is passed, the function returns true if _all_ instances are associated\r\n   *\r\n   * @param sourceInstance source instance to check for an association with\r\n   * @param targetInstancesOrPks Can be an array of instances or their primary keys\r\n   * @param options Options passed to getAssociations\r\n   */\r\n  async has(\r\n    sourceInstance: SourceModel,\r\n    targetInstancesOrPks: AllowArray<TargetModel | Exclude<TargetModel[TargetKey], any[]>>,\r\n    options?: BelongsToManyHasAssociationMixinOptions<TargetModel>,\r\n  ): Promise<boolean> {\r\n    if (!Array.isArray(targetInstancesOrPks)) {\r\n      targetInstancesOrPks = [targetInstancesOrPks];\r\n    }\r\n\r\n    const targetPrimaryKeys: Array<TargetModel[TargetKey]> = targetInstancesOrPks.map(instance => {\r\n      if (instance instanceof this.target) {\r\n        return (instance as TargetModel).get(this.targetKey);\r\n      }\r\n\r\n      return instance as TargetModel[TargetKey];\r\n    });\r\n\r\n    const associatedObjects: TargetModel[] = await this.get(sourceInstance, {\r\n      ...options,\r\n      raw: true,\r\n      scope: false,\r\n      attributes: [this.targetKey],\r\n      joinTableAttributes: [],\r\n      // TODO: current WhereOptions typings do not allow having 'WhereOptions' inside another 'WhereOptions'\r\n      // @ts-expect-error\r\n      where: {\r\n        [Op.and]: [\r\n          { [this.targetKey]: { [Op.in]: targetPrimaryKeys } },\r\n          options?.where,\r\n        ],\r\n      },\r\n    });\r\n\r\n    return targetPrimaryKeys.every(pk => {\r\n      return associatedObjects.some(instance => {\r\n        // instance[x] instead of instance.get() because the query output is 'raw'\r\n        // isEqual is used here because the PK can be a non-primitive value, such as a Buffer\r\n        return isEqual(instance[this.targetKey], pk);\r\n      });\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Set the associated models by passing an array of instances or their primary keys.\r\n   * Everything that it not in the passed array will be un-associated.\r\n   *\r\n   * @param sourceInstance source instance to associate new instances with\r\n   * @param newInstancesOrPrimaryKeys A single instance or primary key, or a mixed array of persisted instances or primary keys\r\n   * @param options Options passed to `through.findAll`, `bulkCreate`, `update` and `destroy`\r\n   */\r\n  async set(\r\n    sourceInstance: SourceModel,\r\n    newInstancesOrPrimaryKeys: AllowArray<TargetModel | Exclude<TargetModel[TargetKey], any[]>>,\r\n    options: BelongsToManySetAssociationsMixinOptions<TargetModel> = {},\r\n  ): Promise<void> {\r\n    const sourceKey = this.sourceKey;\r\n    const targetKey = this.targetKey;\r\n    const foreignKey = this.foreignKey;\r\n    const otherKey = this.otherKey;\r\n\r\n    const newInstances = newInstancesOrPrimaryKeys === null ? [] : this.toInstanceArray(newInstancesOrPrimaryKeys);\r\n\r\n    const where = {\r\n      [foreignKey]: sourceInstance.get(sourceKey),\r\n      ...this.through.scope,\r\n    };\r\n\r\n    const currentThroughRows: ThroughModel[] = await this.through.model.findAll({\r\n      ...options,\r\n      where,\r\n      raw: true,\r\n      // force this option to be false, in case the user enabled\r\n      rejectOnEmpty: false,\r\n    });\r\n\r\n    const obsoleteTargets: Array<TargetModel | Exclude<TargetModel[TargetKey], any[]>> = [];\r\n\r\n    // find all obsolete targets\r\n    for (const currentRow of currentThroughRows) {\r\n      const newTarget = newInstances.find(obj => {\r\n        // @ts-expect-error -- the findAll call is raw, no model here\r\n        return currentRow[otherKey] === obj.get(targetKey);\r\n      });\r\n\r\n      if (!newTarget) {\r\n        // @ts-expect-error -- the findAll call is raw, no model here\r\n        obsoleteTargets.push(currentRow[this.otherKey]);\r\n      }\r\n    }\r\n\r\n    const promises: Array<Promise<any>> = [];\r\n    if (obsoleteTargets.length > 0) {\r\n      promises.push(this.remove(sourceInstance, obsoleteTargets, options));\r\n    }\r\n\r\n    if (newInstances.length > 0) {\r\n      promises.push(this.#updateAssociations(sourceInstance, currentThroughRows, newInstances, options));\r\n    }\r\n\r\n    await Promise.all(promises);\r\n  }\r\n\r\n  /**\r\n   * Associate one or several rows with source instance. It will not un-associate any already associated instance\r\n   * that may be missing from `newInstances`.\r\n   *\r\n   * @param sourceInstance source instance to associate new instances with\r\n   * @param newInstancesOrPrimaryKeys A single instance or primary key, or a mixed array of persisted instances or primary keys\r\n   * @param options Options passed to `through.findAll`, `bulkCreate` and `update`\r\n   */\r\n  async add(\r\n    sourceInstance: SourceModel,\r\n    newInstancesOrPrimaryKeys: AllowArray<TargetModel | Exclude<TargetModel[TargetKey], any[]>>,\r\n    options?: BelongsToManyAddAssociationsMixinOptions<TargetModel>,\r\n  ): Promise<void> {\r\n    // If newInstances is null or undefined, no-op\r\n    if (!newInstancesOrPrimaryKeys) {\r\n      return;\r\n    }\r\n\r\n    const newInstances = this.toInstanceArray(newInstancesOrPrimaryKeys);\r\n\r\n    const currentRows = await this.through.model.findAll({\r\n      ...options,\r\n      raw: true,\r\n      where: {\r\n        [this.foreignKey]: sourceInstance.get(this.sourceKey),\r\n        [this.otherKey]: newInstances.map(newInstance => newInstance.get(this.targetKey)),\r\n        ...this.through.scope,\r\n      },\r\n      // force this option to be false, in case the user enabled\r\n      rejectOnEmpty: false,\r\n    });\r\n\r\n    await this.#updateAssociations(sourceInstance, currentRows, newInstances, options);\r\n  }\r\n\r\n  /**\r\n   * Adds new target instances that were not already present in the through table.\r\n   * Updates the through table row of the instances that already were present.\r\n   *\r\n   * @param sourceInstance\r\n   * @param currentThroughRows\r\n   * @param newTargets\r\n   * @param options\r\n   * @private\r\n   */\r\n  async #updateAssociations(\r\n    sourceInstance: SourceModel,\r\n    currentThroughRows: ThroughModel[],\r\n    newTargets: TargetModel[],\r\n    options?:\r\n      & { through?: JoinTableAttributes }\r\n      & BulkCreateOptions<Attributes<ThroughModel>>\r\n      & Omit<UpdateOptions<Attributes<ThroughModel>>, 'where'>,\r\n  ) {\r\n    const sourceKey = this.sourceKey;\r\n    const targetKey = this.targetKey;\r\n    const foreignKey = this.foreignKey;\r\n    const otherKey = this.otherKey;\r\n\r\n    const defaultAttributes = options?.through || {};\r\n\r\n    const promises: Array<Promise<any>> = [];\r\n    const unassociatedTargets: TargetModel[] = [];\r\n    // the 'through' table of these targets has changed\r\n    const changedTargets: TargetModel[] = [];\r\n    for (const newInstance of newTargets) {\r\n      const existingThroughRow = currentThroughRows.find(throughRow => {\r\n        // @ts-expect-error -- throughRow[] instead of .get because throughRows are loaded using 'raw'\r\n        return throughRow[otherKey] === newInstance.get(targetKey);\r\n      });\r\n\r\n      if (!existingThroughRow) {\r\n        unassociatedTargets.push(newInstance);\r\n\r\n        continue;\r\n      }\r\n\r\n      // @ts-expect-error -- gets the content of the \"through\" table for this association that is set on the model\r\n      const throughAttributes = newInstance[this.through.model.name];\r\n      const attributes = { ...defaultAttributes, ...throughAttributes };\r\n\r\n      if (Object.keys(attributes).some(attribute => {\r\n        // @ts-expect-error existingThroughRow is raw\r\n        return attributes[attribute] !== existingThroughRow[attribute];\r\n      })) {\r\n        changedTargets.push(newInstance);\r\n      }\r\n    }\r\n\r\n    if (unassociatedTargets.length > 0) {\r\n      const bulk = unassociatedTargets.map(unassociatedTarget => {\r\n        // @ts-expect-error -- gets the content of the \"through\" table for this association that is set on the model\r\n        const throughAttributes = unassociatedTarget[this.through.model.name];\r\n        const attributes = { ...defaultAttributes, ...throughAttributes };\r\n\r\n        attributes[foreignKey] = sourceInstance.get(sourceKey);\r\n        attributes[otherKey] = unassociatedTarget.get(targetKey);\r\n\r\n        Object.assign(attributes, this.through.scope);\r\n\r\n        return attributes;\r\n      });\r\n\r\n      promises.push(this.through.model.bulkCreate(bulk, { validate: true, ...options }));\r\n    }\r\n\r\n    for (const changedTarget of changedTargets) {\r\n      // @ts-expect-error -- gets the content of the \"through\" table for this association that is set on the model\r\n      let throughAttributes = changedTarget[this.through.model.name];\r\n      const attributes = { ...defaultAttributes, ...throughAttributes };\r\n      // Quick-fix for subtle bug when using existing objects that might have the through model attached (not as an attribute object)\r\n      if (throughAttributes instanceof this.through.model) {\r\n        throughAttributes = {};\r\n      }\r\n\r\n      promises.push(this.through.model.update(attributes, {\r\n        ...options,\r\n        where: {\r\n          [foreignKey]: sourceInstance.get(sourceKey),\r\n          [otherKey]: changedTarget.get(targetKey),\r\n        },\r\n      }));\r\n    }\r\n\r\n    await Promise.all(promises);\r\n  }\r\n\r\n  /**\r\n   * Un-associate one or more instance(s).\r\n   *\r\n   * @param sourceInstance instance to un associate instances with\r\n   * @param targetInstanceOrPks Can be an Instance or its primary key, or a mixed array of instances and primary keys\r\n   * @param options Options passed to `through.destroy`\r\n   */\r\n  async remove(\r\n    sourceInstance: SourceModel,\r\n    targetInstanceOrPks: AllowArray<TargetModel | Exclude<TargetModel[TargetKey], any[]>>,\r\n    options?: BelongsToManyRemoveAssociationMixinOptions,\r\n  ): Promise<void> {\r\n    const targetInstance = this.toInstanceArray(targetInstanceOrPks);\r\n\r\n    const where = {\r\n      [this.foreignKey]: sourceInstance.get(this.sourceKey),\r\n      [this.otherKey]: targetInstance.map(newInstance => newInstance.get(this.targetKey)),\r\n      ...this.through.scope,\r\n    };\r\n\r\n    await this.through.model.destroy({ ...options, where });\r\n  }\r\n\r\n  /**\r\n   * Create a new instance of the associated model and associate it with this.\r\n   *\r\n   * @param sourceInstance source instance\r\n   * @param values values for target model\r\n   * @param options Options passed to create and add\r\n   */\r\n  async create(\r\n    sourceInstance: SourceModel,\r\n    // @ts-expect-error -- {} is not always assignable to 'values', but Target.create will enforce this, not us.\r\n    values: CreationAttributes<TargetModel> = {},\r\n    options:\r\n      | BelongsToManyCreateAssociationMixinOptions<TargetModel>\r\n      | BelongsToManyCreateAssociationMixinOptions<TargetModel>['fields'] = {},\r\n  ): Promise<TargetModel> {\r\n    if (Array.isArray(options)) {\r\n      options = {\r\n        fields: options,\r\n      };\r\n    }\r\n\r\n    if (this.scope) {\r\n      Object.assign(values, this.scope);\r\n      if (options.fields) {\r\n        options.fields = [...options.fields, ...Object.keys(this.scope)];\r\n      }\r\n    }\r\n\r\n    // Create the related model instance\r\n    const newAssociatedObject = await this.target.create(values, options);\r\n\r\n    await this.add(sourceInstance, newAssociatedObject, omit(options, ['fields']));\r\n\r\n    return newAssociatedObject;\r\n  }\r\n}\r\n\r\n// workaround https://github.com/evanw/esbuild/issues/1260\r\nObject.defineProperty(BelongsToMany, 'name', {\r\n  value: 'BelongsToMany',\r\n});\r\n\r\nexport function isThroughOptions<M extends Model>(val: any): val is ThroughOptions<M> {\r\n  return isPlainObject(val) && 'model' in val;\r\n}\r\n\r\nfunction normalizeThroughOptions<M extends Model>(\r\n  source: ModelStatic<any>,\r\n  target: ModelStatic<any>,\r\n  through: ThroughOptions<M>,\r\n  sequelize: Sequelize,\r\n): NormalizedThroughOptions<M> {\r\n  const timestamps = through.timestamps ?? sequelize.options.define?.timestamps;\r\n\r\n  let model;\r\n\r\n  if (!through || (typeof through.model !== 'string' && !isModelStatic(through.model))) {\r\n    throw new AssociationError(`${source.name}.belongsToMany(${target.name}) requires a through model, set the \"through\", or \"through.model\" options to either a string or a model`);\r\n  }\r\n\r\n  if (isModelStatic<M>(through.model)) {\r\n    model = through.model;\r\n  } else if (sequelize.isDefined(through.model)) {\r\n    model = sequelize.model(through.model) as ModelStatic<M>;\r\n  } else {\r\n    model = sequelize.define(through.model, {} as ModelAttributes<M>, {\r\n      tableName: through.model,\r\n      indexes: [], // we don't want indexes here (as referenced in #2416)\r\n      paranoid: through.paranoid || false, // Default to non-paranoid join (referenced in #11991)\r\n      validate: {}, // Don't propagate model-level validations\r\n      timestamps: through.timestamps,\r\n\r\n      // @ts-expect-error -- TODO: make 'schema' a public property on Model once the method has been removed (sequelize 8)\r\n      schema: source._schema,\r\n      // @ts-expect-error\r\n      schemaDelimiter: source._schemaDelimiter,\r\n    });\r\n  }\r\n\r\n  return {\r\n    ...through,\r\n    timestamps,\r\n    model,\r\n  };\r\n}\r\n\r\nfunction normalizeOptions<SourceKey extends string, TargetKey extends string, ThroughModel extends Model>(\r\n  type: AssociationStatic<any>,\r\n  options: BelongsToManyOptions<SourceKey, TargetKey, ThroughModel>,\r\n  source: ModelStatic<Model>,\r\n  target: ModelStatic<Model>,\r\n): NormalizedBelongsToManyOptions<SourceKey, TargetKey, ThroughModel> {\r\n\r\n  if ('timestamps' in options) {\r\n    throw new TypeError('The \"timestamps\" option in belongsToMany has been renamed to through.timestamps');\r\n  }\r\n\r\n  if ('uniqueKey' in options) {\r\n    throw new TypeError('The \"uniqueKey\" option in belongsToMany has been renamed to through.unique');\r\n  }\r\n\r\n  const sequelize = target.sequelize!;\r\n\r\n  return normalizeBaseAssociationOptions(type, {\r\n    ...options,\r\n    otherKey: normalizeForeignKeyOptions(options.otherKey),\r\n    through: removeUndefined(isThroughOptions(options.through)\r\n      ? normalizeThroughOptions(source, target, options.through, sequelize)\r\n      : normalizeThroughOptions(source, target, { model: options.through }, sequelize)),\r\n  }, source, target);\r\n}\r\n\r\n/**\r\n * Used for the through table in n:m associations.\r\n *\r\n * Used in {@link BelongsToManyOptions.through}\r\n */\r\nexport interface ThroughOptions<ThroughModel extends Model> {\r\n  /**\r\n   * The model used to join both sides of the N:M association.\r\n   * Can be a string if you want the model to be generated by sequelize.\r\n   */\r\n  model: ModelStatic<ThroughModel> | string;\r\n\r\n  /**\r\n   * See {@link ModelOptions.timestamps}\r\n   */\r\n  timestamps?: ModelOptions['timestamps'];\r\n\r\n  /**\r\n   * See {@link ModelOptions.paranoid}\r\n   */\r\n  paranoid?: ModelOptions['paranoid'];\r\n\r\n  /**\r\n   * A key/value set that will be used for association create and find defaults on the through model.\r\n   * (Remember to add the attributes to the through model)\r\n   */\r\n  scope?: AssociationScope;\r\n\r\n  /**\r\n   * If true a unique constraint will be added on the foreign key pair.\r\n   * If set to a string, the generated unique key will use the string as its name.\r\n   * If set to false, no unique constraint will be added.\r\n   * Useful if you want to turn this off and create your own unique constraint when using scopes.\r\n   *\r\n   * This option only works if the model already has a Primary Key,\r\n   * as the unique constraint will not be added if the foreign keys are already part of the composite primary key.\r\n   *\r\n   * @default true\r\n   */\r\n  unique?: boolean | string;\r\n}\r\n\r\n/**\r\n * Attributes for the join table\r\n */\r\nexport interface JoinTableAttributes {\r\n  [attribute: string]: unknown;\r\n}\r\n\r\ntype NormalizedBelongsToManyOptions<\r\n  SourceKey extends string,\r\n  TargetKey extends string,\r\n  ThroughModel extends Model,\r\n> =\r\n  & Omit<BelongsToManyOptions<SourceKey, TargetKey, ThroughModel>, 'through' | 'as' | 'hooks' | 'foreignKey'>\r\n  & { through: NormalizedThroughOptions<ThroughModel> }\r\n  & Pick<NormalizedAssociationOptions<string>, 'as' | 'name' | 'hooks' | 'foreignKey'>;\r\n\r\ntype NormalizedThroughOptions<ThroughModel extends Model> = Omit<ThroughOptions<ThroughModel>, 'model'> & {\r\n  model: ModelStatic<ThroughModel>,\r\n};\r\n\r\n/**\r\n * Options provided when associating models with belongsToMany relationship.\r\n *\r\n * Used by {@link Model.belongsToMany}.\r\n */\r\nexport interface BelongsToManyOptions<\r\n  SourceKey extends string = string,\r\n  TargetKey extends string = string,\r\n  ThroughModel extends Model = Model,\r\n> extends MultiAssociationOptions<AttributeNames<ThroughModel>> {\r\n  /**\r\n   * Configures this association on the target model.\r\n   */\r\n  inverse?: {\r\n    as?: AssociationOptions<string>['as'],\r\n    scope?: MultiAssociationOptions<string>['scope'],\r\n    foreignKeyConstraints?: AssociationOptions<string>['foreignKeyConstraints'],\r\n  };\r\n\r\n  // this is also present in AssociationOptions, but they have different JSDoc, keep both!\r\n  /**\r\n   * Should \"ON UPDATE\", \"ON DELETE\" and \"REFERENCES\" constraints be enabled on the foreign key?\r\n   *\r\n   * This only affects the foreign key that points to the source model.\r\n   * to control the one that points to the target model, set {@link BelongsToManyOptions.inverse.foreignKeyConstraints}.\r\n   */\r\n  foreignKeyConstraints?: boolean;\r\n\r\n  /**\r\n   * The name of the table that is used to join source and target in n:m associations. Can also be a\r\n   * sequelize model if you want to define the junction table yourself and add extra attributes to it.\r\n   */\r\n  through: ModelStatic<ThroughModel> | string | ThroughOptions<ThroughModel>;\r\n\r\n  /**\r\n   * The name of the foreign key in the join table (representing the target model) or an object representing\r\n   * the type definition for the other column (see `Sequelize.define` for syntax). When using an object, you\r\n   * can add a `name` property to set the name of the colum. Defaults to the name of target + primary key of\r\n   * target\r\n   */\r\n  otherKey?: AttributeNames<ThroughModel> | ForeignKeyOptions<AttributeNames<ThroughModel>>;\r\n\r\n  /**\r\n   * The name of the field to use as the key for the association in the source table. Defaults to the primary\r\n   * key of the source table\r\n   */\r\n  sourceKey?: SourceKey;\r\n\r\n  /**\r\n   * The name of the field to use as the key for the association in the target table. Defaults to the primary\r\n   * key of the target table\r\n   */\r\n  targetKey?: TargetKey;\r\n}\r\n\r\n/**\r\n * The options for the getAssociations mixin of the belongsToMany association.\r\n *\r\n * @see BelongsToManyGetAssociationsMixin\r\n */\r\nexport interface BelongsToManyGetAssociationsMixinOptions<T extends Model> extends FindOptions<Attributes<T>> {\r\n  /**\r\n   * A list of the attributes from the join table that you want to select.\r\n   */\r\n  joinTableAttributes?: FindAttributeOptions;\r\n  /**\r\n   * Apply a scope on the related model, or remove its default scope by passing false.\r\n   */\r\n  scope?: string | boolean;\r\n\r\n  /**\r\n   * Apply a schema on the related model\r\n   */\r\n  schema?: string;\r\n  schemaDelimiter?: string;\r\n\r\n  through?: {\r\n    where?: WhereOptions,\r\n    paranoid?: boolean,\r\n  };\r\n}\r\n\r\n/**\r\n * The getAssociations mixin applied to models with belongsToMany.\r\n * An example of usage is as follows:\r\n *\r\n * ```typescript\r\n * class User extends Model<InferAttributes<User>, InferCreationAttributes<User>> {\r\n *  declare getRoles: BelongsToManyGetAssociationsMixin<Role>;\r\n * }\r\n *\r\n * User.belongsToMany(Role, { through: UserRole });\r\n * ```\r\n *\r\n * @see Model.belongsToMany\r\n */\r\nexport type BelongsToManyGetAssociationsMixin<T extends Model> = (\r\n  options?: BelongsToManyGetAssociationsMixinOptions<T>\r\n) => Promise<T[]>;\r\n\r\n/**\r\n * The options for the setAssociations mixin of the belongsToMany association.\r\n *\r\n * @see BelongsToManySetAssociationsMixin\r\n */\r\nexport interface BelongsToManySetAssociationsMixinOptions<TargetModel extends Model>\r\n  extends FindOptions<Attributes<TargetModel>>,\r\n    BulkCreateOptions<Attributes<TargetModel>>,\r\n    InstanceUpdateOptions<Attributes<TargetModel>>,\r\n    InstanceDestroyOptions {\r\n\r\n  /**\r\n   * Additional attributes for the join table.\r\n   */\r\n  through?: JoinTableAttributes;\r\n}\r\n\r\n/**\r\n * The setAssociations mixin applied to models with belongsToMany.\r\n * An example of usage is as follows:\r\n *\r\n * ```typescript\r\n * class User extends Model<InferAttributes<User>, InferCreationAttributes<User>> {\r\n *   declare setRoles: BelongsToManySetAssociationsMixin<Role, Role['id']>;\r\n * }\r\n *\r\n * User.belongsToMany(Role, { through: UserRole });\r\n * ```\r\n *\r\n * @see Model.belongsToMany\r\n */\r\nexport type BelongsToManySetAssociationsMixin<TModel extends Model, TModelPrimaryKey> = (\r\n  newAssociations?: Array<TModel | TModelPrimaryKey>,\r\n  options?: BelongsToManySetAssociationsMixinOptions<TModel>\r\n) => Promise<void>;\r\n\r\n/**\r\n * The options for the addAssociations mixin of the belongsToMany association.\r\n *\r\n * @see BelongsToManyAddAssociationsMixin\r\n */\r\nexport interface BelongsToManyAddAssociationsMixinOptions<TModel extends Model>\r\n  extends FindOptions<Attributes<TModel>>,\r\n    BulkCreateOptions<Attributes<TModel>>,\r\n    InstanceUpdateOptions<Attributes<TModel>>,\r\n    InstanceDestroyOptions {\r\n  through?: JoinTableAttributes;\r\n}\r\n\r\n/**\r\n * The addAssociations mixin applied to models with belongsToMany.\r\n * An example of usage is as follows:\r\n *\r\n * ```typescript\r\n * class User extends Model<InferAttributes<User>, InferCreationAttributes<User>> {\r\n *   declare addRoles: BelongsToManyAddAssociationsMixin<Role, Role['id']>;\r\n * }\r\n *\r\n * User.belongsToMany(Role, { through: UserRole });\r\n * ```\r\n *\r\n * @see Model.belongsToMany\r\n */\r\nexport type BelongsToManyAddAssociationsMixin<T extends Model, TModelPrimaryKey> = (\r\n  newAssociations?: Array<T | TModelPrimaryKey>,\r\n  options?: BelongsToManyAddAssociationsMixinOptions<T>\r\n) => Promise<void>;\r\n\r\n/**\r\n * The options for the addAssociation mixin of the belongsToMany association.\r\n *\r\n * @see BelongsToManyAddAssociationMixin\r\n */\r\nexport interface BelongsToManyAddAssociationMixinOptions<T extends Model>\r\n  extends FindOptions<Attributes<T>>,\r\n    BulkCreateOptions<Attributes<T>>,\r\n    InstanceUpdateOptions<Attributes<T>>,\r\n    InstanceDestroyOptions {\r\n  through?: JoinTableAttributes;\r\n}\r\n\r\n/**\r\n * The addAssociation mixin applied to models with belongsToMany.\r\n * An example of usage is as follows:\r\n *\r\n * ```typescript\r\n * class User extends Model<InferAttributes<User>, InferCreationAttributes<User>> {\r\n *   declare addRole: BelongsToManyAddAssociationMixin<Role, Role['id']>;\r\n * }\r\n *\r\n * User.belongsToMany(Role, { through: UserRole });\r\n * ```\r\n *\r\n * @see Model.belongsToMany\r\n */\r\nexport type BelongsToManyAddAssociationMixin<T extends Model, TModelPrimaryKey> = (\r\n  newAssociation?: T | TModelPrimaryKey,\r\n  options?: BelongsToManyAddAssociationMixinOptions<T>\r\n) => Promise<void>;\r\n\r\n/**\r\n * The options for the createAssociation mixin of the belongsToMany association.\r\n *\r\n * @see BelongsToManyCreateAssociationMixin\r\n */\r\nexport interface BelongsToManyCreateAssociationMixinOptions<T extends Model>\r\n  extends CreateOptions<Attributes<T>> {\r\n\r\n  through?: JoinTableAttributes;\r\n}\r\n/**\r\n * The createAssociation mixin applied to models with belongsToMany.\r\n * An example of usage is as follows:\r\n *\r\n * ```typescript\r\n * class User extends Model<InferAttributes<User>, InferCreationAttributes<User>> {\r\n *   declare createRole: BelongsToManyCreateAssociationMixin<Role>;\r\n * }\r\n *\r\n * User.belongsToMany(Role, { through: UserRole });\r\n * ```\r\n *\r\n * @see Model.belongsToMany\r\n */\r\nexport type BelongsToManyCreateAssociationMixin<T extends Model> = (\r\n  values?: CreationAttributes<T>,\r\n  options?: BelongsToManyCreateAssociationMixinOptions<T>\r\n) => Promise<T>;\r\n\r\n/**\r\n * The options for the removeAssociation mixin of the belongsToMany association.\r\n *\r\n * @see BelongsToManyRemoveAssociationMixin\r\n */\r\nexport interface BelongsToManyRemoveAssociationMixinOptions extends InstanceDestroyOptions {}\r\n\r\n/**\r\n * The removeAssociation mixin applied to models with belongsToMany.\r\n * An example of usage is as follows:\r\n *\r\n * ```typescript\r\n * class User extends Model<InferAttributes<User>, InferCreationAttributes<User>> {\r\n *   declare removeRole: BelongsToManyRemoveAssociationMixin<Role, Role['id']>;\r\n * }\r\n *\r\n * User.belongsToMany(Role, { through: UserRole });\r\n * ```\r\n *\r\n * @see Model.belongsToMany\r\n */\r\nexport type BelongsToManyRemoveAssociationMixin<TModel, TModelPrimaryKey> = (\r\n  oldAssociated?: TModel | TModelPrimaryKey,\r\n  options?: BelongsToManyRemoveAssociationMixinOptions\r\n) => Promise<void>;\r\n\r\n/**\r\n * The options for the removeAssociations mixin of the belongsToMany association.\r\n *\r\n * @see BelongsToManyRemoveAssociationsMixin\r\n */\r\nexport interface BelongsToManyRemoveAssociationsMixinOptions extends InstanceDestroyOptions, InstanceDestroyOptions {}\r\n\r\n/**\r\n * The removeAssociations mixin applied to models with belongsToMany.\r\n * An example of usage is as follows:\r\n *\r\n * ```typescript\r\n * class User extends Model<InferAttributes<User>, InferCreationAttributes<User>> {\r\n *   declare removeRoles: BelongsToManyRemoveAssociationsMixin<Role, Role['id']>;\r\n * }\r\n *\r\n * User.belongsToMany(Role, { through: UserRole });\r\n * ```\r\n *\r\n * @see Model.belongsToMany\r\n */\r\nexport type BelongsToManyRemoveAssociationsMixin<TModel, TModelPrimaryKey> = (\r\n  associationsToRemove?: Array<TModel | TModelPrimaryKey>,\r\n  options?: BelongsToManyRemoveAssociationsMixinOptions\r\n) => Promise<void>;\r\n\r\n/**\r\n * The options for the hasAssociation mixin of the belongsToMany association.\r\n *\r\n * @see BelongsToManyHasAssociationMixin\r\n */\r\nexport interface BelongsToManyHasAssociationMixinOptions<T extends Model>\r\n  extends BelongsToManyGetAssociationsMixinOptions<T> {}\r\n\r\n/**\r\n * The hasAssociation mixin applied to models with belongsToMany.\r\n * An example of usage is as follows:\r\n *\r\n * ```typescript\r\n * class User extends Model<InferAttributes<User>, InferCreationAttributes<User>> {\r\n *   declare hasRole: BelongsToManyHasAssociationMixin<Role, Role['id']>;\r\n * }\r\n *\r\n * User.belongsToMany(Role, { through: UserRole });\r\n * ```\r\n *\r\n * @see Model.belongsToMany\r\n */\r\nexport type BelongsToManyHasAssociationMixin<TModel extends Model, TModelPrimaryKey> = (\r\n  target: TModel | TModelPrimaryKey,\r\n  options?: BelongsToManyHasAssociationMixinOptions<TModel>\r\n) => Promise<boolean>;\r\n\r\n/**\r\n * The options for the hasAssociations mixin of the belongsToMany association.\r\n *\r\n * @see BelongsToManyHasAssociationsMixin\r\n */\r\nexport interface BelongsToManyHasAssociationsMixinOptions<T extends Model>\r\n  extends BelongsToManyGetAssociationsMixinOptions<T> {}\r\n\r\n/**\r\n * The removeAssociations mixin applied to models with belongsToMany.\r\n * An example of usage is as follows:\r\n *\r\n * ```typescript\r\n * class User extends Model<InferAttributes<User>, InferCreationAttributes<User>> {\r\n *   declare hasRoles: BelongsToManyHasAssociationsMixin<Role, Role['id']>;\r\n * }\r\n *\r\n * User.belongsToMany(Role, { through: UserRole });\r\n * ```\r\n *\r\n * @see Model.belongsToMany\r\n */\r\nexport type BelongsToManyHasAssociationsMixin<TModel extends Model, TModelPrimaryKey> = (\r\n  targets: Array<TModel | TModelPrimaryKey>,\r\n  options?: BelongsToManyHasAssociationsMixinOptions<TModel>\r\n) => Promise<boolean>;\r\n\r\n/**\r\n * The options for the countAssociations mixin of the belongsToMany association.\r\n *\r\n * @see BelongsToManyCountAssociationsMixin\r\n */\r\nexport interface BelongsToManyCountAssociationsMixinOptions<T extends Model>\r\n  extends Transactionable, Filterable<Attributes<T>> {\r\n  /**\r\n   * Apply a scope on the related model, or remove its default scope by passing false.\r\n   */\r\n  scope?: string | boolean;\r\n}\r\n\r\n/**\r\n * The countAssociations mixin applied to models with belongsToMany.\r\n * An example of usage is as follows:\r\n *\r\n * ```typescript\r\n * class User extends Model<InferAttributes<User>, InferCreationAttributes<User>> {\r\n *   declare countRoles: Sequelize.BelongsToManyCountAssociationsMixin;\r\n * }\r\n *\r\n * User.belongsToMany(Role, { through: UserRole });\r\n * ```\r\n *\r\n * @see Model.belongsToMany\r\n */\r\nexport type BelongsToManyCountAssociationsMixin<T extends Model> = (\r\n  options?: BelongsToManyCountAssociationsMixinOptions<T>\r\n) => Promise<number>;\r\n"],
  "mappings": "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",
  "names": []
}
